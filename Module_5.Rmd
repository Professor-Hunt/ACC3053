---
title: "Module 5"
description: |
  This module is an introduction to data visualization and ggplot.
output: 
  distill::distill_article:
    #code_folding: true
    toc: true
    toc_depth: 3
---

# Module objectives

-   Demonstrate knowledge of what makes an effective visualization

-   Demonstrate knowledge of use cases for visualizations

-   Demonstrate how to create basic visualizations and dashboards

## PWC: What is required to do data analysis?

![](images/PwcDataAnalysis.png){width="100%"}

## Visual analysis -- Why is it important?

-   Using simple graphical information to gain insight and solve real-world (business) problems

-   The purpose of information visualization is to help us think by assisting memory and representing data in ways that our brain could easily comprehend

    -   Visualizing datasets side-by-side allows us to make immediate comparisons

    -   Charting measures over time help us understand behavior trends

    -   Dashboards allow us to see data from many perspectives at once to start to find reasons for trends or anomalies

-   Interactive and interesting

## What is a dashboard?

A dashboard is a business intelligence management tool used to determine performance and progress towards business goals. Successful dashboards should have:

-   Proper Metrics

    -   Relevant to the past, present, or future

    -   Should be actionable

-   Executive Support

    -   Buy-in should come from the top

    -   Should be viewed as critical decision support tools

-   Simplicity

    -   Users should not need a lengthy manual to understand the information presented

    -   Information should be communicated in a straight forward way

# Using R for Visualizations

## The grammar of graphics 

The specific content largely comes from [ModernDive](https://moderndive.com/index.html) and [R for Data Science](https://r4ds.had.co.nz/index.html).

We start with a discussion of a theoretical framework for data visualization known as "the grammar of graphics." This framework serves as the foundation for the ggplot2 package which we'll use extensively in this chapter. Think of how we construct and form sentences in English by combining different elements, like nouns, verbs, articles, subjects, objects, etc. We can't just combine these elements in any arbitrary order; we must do so following a set of rules known as a linguistic grammar. Similarly to a linguistic grammar, "the grammar of graphics" defines a set of rules for constructing statistical graphics by combining different types of layers. This grammar was created by Leland Wilkinson (Wilkinson 2005) and has been implemented in a variety of data visualization software platforms like R, but also Plotly and Tableau.

## Components of the grammar In short, the grammar tells us that:

A statistical graphic is a mapping of data variables to aesthetic attributes of geometric objects.

**A statistical graphic is a `mapping` of `data` variables to `aes`thetic attributes of `geom`etric objects.**

Specifically, we can break a graphic into the following three essential components:

data: the dataset containing the variables of interest. geom: the geometric object in question. This refers to the type of object we can observe in a plot. For example: points, lines, and bars. aes: aesthetic attributes of the geometric object. For example, x/y position, color, shape, and size. Aesthetic attributes are mapped to variables in the dataset. You might be wondering why we wrote the terms data, geom, and aes in a computer code type font. We'll see very shortly that we'll specify the elements of the grammar in R using these terms. However, let's first break down the grammar with an example.

```{r loaddata}
#load data. 
#curl package lets us download data from a website with the proper location
#check the packages tab and see if you have curl
#try following
  #?curl
library(tidyverse)
library(curl)

load(curl("https://raw.githubusercontent.com/Professor-Hunt/ACC3053/main/data/AnnualCompanyData.Rda"))
```

## Graph Introduction

[Scatter Plots](https://moderndive.com/2-viz.html#scatterplots)

```{r}

ggplot(data = AnnualCompanyData, mapping = aes(x = NetIncome, y = LongtermDebt)) + 
  geom_point()

ggplot(data = AnnualCompanyData, mapping = aes(x = NetIncome, y = LongtermDebt)) + 
  geom_point()+xlim(-20000,20000)+ylim(0,100000)
```

[Line Graph](https://moderndive.com/2-viz.html#linegraphs)

```{r,echo=TRUE}
#line graph..

linegraph1<-AnnualCompanyData

ggplot(data=linegraph1,mapping = aes(x=FiscalYear,y=TotalAssets))+geom_line()


linegraph2<-AnnualCompanyData%>%
  filter(CompanyName=="APPLE INC")

ggplot(data=linegraph2,mapping = aes(x=FiscalYear,y=TotalAssets))+geom_line()


linegraph3<-AnnualCompanyData%>%
  group_by(FiscalYear)%>%
  summarise(mean_TotalAssets=mean(TotalAssets,na.rm=TRUE))

ggplot(data=linegraph3,mapping = aes(x=FiscalYear,y=mean_TotalAssets))+geom_line()

```

[Histograms](https://moderndive.com/2-viz.html#histograms)

```{r,echo=TRUE}

ggplot(data=AnnualCompanyData,mapping = aes(x=NetIncome,fill=factor(FiscalYear)))+geom_histogram(position = "dodge")
```

[Boxplots](https://moderndive.com/2-viz.html#boxplots)

```{r,echo=TRUE}
ggplot(data=AnnualCompanyData,mapping = aes(x=NetIncome,y=factor(FiscalYear)))+geom_boxplot()
```

[Bar plots](https://moderndive.com/2-viz.html#geombar)

```{r,echo=TRUE}

bardata<-AnnualCompanyData%>%
  mutate(sic1=factor(substr(sic,0,1)))
  
ggplot(data=bardata,mapping = aes(x=sic1, fill=sic1))+geom_bar()
```

## ggplot2 package

we will use the `ggplot2` package for data visualization, which is an implementation of the `g`rammar of `g`raphics for R (Wickham, Chang, et al. [2021](https://moderndive.com/2-viz.html#ref-R-ggplot2)). As we noted earlier, a lot of the previous section was written in a computer code type font. This is because the various components of the grammar of graphics are specified in the `ggplot()` function included in the `ggplot2` package. For the purposes of this class, we'll always provide the `ggplot()` function with the following arguments (i.e., inputs) at a minimum:

-   The data frame where the variables exist: the `data` argument.

-   The mapping of the variables to aesthetic attributes: the `mapping` argument which specifies the `aes`thetic attributes involved.

After we've specified these components, we then add *layers* to the plot using the `+` sign. The most essential layer to add to a plot is the layer that specifies which type of `geom`etric object we want the plot to involve: points, lines, bars, and others. Other layers we can add to a plot include the plot title, axes labels, visual themes for the plots, and facets

## Lets get some more data:

This loads data directly from my GitHub ðŸ˜ˆ

```{r getdata}

library(curl)

load(curl("https://raw.githubusercontent.com/Professor-Hunt/ACC3053/main/data/Orders_Data.Rda"))

load(curl("https://raw.githubusercontent.com/Professor-Hunt/ACC3053/main/data/People_Data.Rda"))

load(curl("https://raw.githubusercontent.com/Professor-Hunt/ACC3053/main/data/Returns_Data.Rda"))

```

Make sure you load the proper libraries:

```{r libs}

library(tidyverse)
```

# First Steps:

Lets answer a question: What is the relationship between Sales and Profit?

## Creating the plot:

```{r plot1}

ggplot(data = Orders_Data) + 
  geom_point(mapping = aes(x = Profit, y = Sales))

# ggplot(data = Orders_Data,aes(x = Profit, y = Sales)) + 
#   geom_point()

```

This plot is not as clear as we expected. Sales is positively related to Profit, but it is not as strong as you might have expected.

With ggplot2, you begin a plot with the function `ggplot()`. `ggplot()` creates a coordinate system that you can add layers to. The first argument of `ggplot()` is the dataset to use in the graph.

You complete your graph by adding one or more layers to `ggplot()`. The function `geom_point()` adds a layer of points to your plot, which creates a scatterplot. ggplot2 comes with many geom functions that each add a different type of layer to a plot.

Each geom function in ggplot2 takes a `mapping` argument. This defines how variables in your dataset are mapped to visual properties. The `mapping` argument is always paired with `aes()`, and the `x` and `y` arguments of `aes()` specify which variables to map to the x and y axes.

## Aesthetic mappings

You can add a third variable, like `Category`, to a two dimensional scatterplot by mapping it to an **aesthetic**. An aesthetic is a visual property of the objects in your plot. Aesthetics include things like the size, the shape, or the color of your points. You can display a point in different ways by changing the values of its aesthetic properties.

You can convey information about your data by mapping the aesthetics in your plot to the variables in your dataset.

```{r plot2}

ggplot(data = Orders_Data) + 
  geom_point(mapping = aes(x = Profit, y = Sales, color=Category))

# ggplot(data = Orders_Data,aes(x = Profit, y = Sales, color=Category)) + 
#   geom_point()
```

To map an aesthetic to a variable, associate the name of the aesthetic to the name of the variable inside `aes()`. ggplot2 will automatically assign a unique level of the aesthetic (here a unique color) to each unique value of the variable, a process known as **scaling**. ggplot2 will also add a legend that explains which levels correspond to which values.

In the above example, we mapped `Category` to the color aesthetic, but we could have mapped `Category` to the size aesthetic in the same way. In this case, the exact size of each point would reveal its class affiliation. We get a *warning* here, because mapping an unordered variable (`Category`) to an ordered aesthetic (`size`) is not a good idea.

```{r plot3 }

ggplot(data = Orders_Data) + 
  geom_point(mapping = aes(x = Profit, y = Sales, size=Category))

 # ggplot(data = Orders_Data,aes(x = Profit, y = Sales, size=Category)) + 
 #   geom_point()
```

Or we could have mapped `Category` to the *alpha* aesthetic, which controls the transparency of the points, or to the shape aesthetic, which controls the shape of the points.

```{r plot4}

ggplot(data = Orders_Data) + 
  geom_point(mapping = aes(x = Profit, y = Sales, alpha=Category))

ggplot(data = Orders_Data) + 
  geom_point(mapping = aes(x = Profit, y = Sales, shape=Category))
```

For each aesthetic, you use `aes()` to associate the name of the aesthetic with a variable to display. The `aes()` function gathers together each of the aesthetic mappings used by a layer and passes them to the layer's mapping argument. The syntax highlights a useful insight about `x` and `y`: the x and y locations of a point are themselves aesthetics, visual properties that you can map to variables to display information about the data.

Once you map an aesthetic, ggplot2 takes care of the rest. It selects a reasonable scale to use with the aesthetic, and it constructs a legend that explains the mapping between levels and values. For x and y aesthetics, ggplot2 does not create a legend, but it creates an axis line with tick marks and a label. The axis line acts as a legend; it explains the mapping between locations and values.

You can also *set* the aesthetic properties of your geom manually. For example, we can make all of the points in our plot blue:

```{r plot5}

ggplot(data = Orders_Data) + 
  geom_point(mapping = aes(x = Profit, y = Sales), color="blue")

ggplot(data = Orders_Data) + 
  geom_point(mapping = aes(x = Profit, y = Sales), shape=2)

```

Here, the color doesn't convey information about a variable, but only changes the appearance of the plot. To set an aesthetic manually, set the aesthetic by name as an argument of your geom function; i.e.Â it goes *outside* of `aes()`. You'll need to pick a level that makes sense for that aesthetic:

-   The name of a color as a character string.

-   The size of a point in mm.

-   The shape of a point as a number
    ![](images/shapes-1.png){width="50%"}

# Exercise 1

Using the following code answer each question.

```{r Ex1, eval=FALSE}

ggplot(data = Orders_Data) + 
  geom_point(mapping = aes(x = Profit, y = Sales))
```

1.  Run `ggplot(data = Orders_Data)`. What do you see?

2.  Make a scatterplot of `Discount` vs `Sales`.

3.  What is wrong with the following code?

    ```{r EX1.3}
    ggplot(data = Orders_Data) + 
      geom_point(mapping = aes(x = Profit, y = Sales, color="blue"))
    ```

4.  Map a continuous variable to `color`, `size`, and `shape`. How do these aesthetics behave differently for categorical vs.Â continuous variables?

5.  What happens if you map the same variable to multiple aesthetics?

# Different Graphs

## Scatter Plots

```{r scat1}

ggplot(data = Orders_Data,aes(x = Profit, y = Sales)) + 
   geom_point()

ggplot(data = Orders_Data) + 
  geom_point(mapping = aes(x = Profit, y = Sales))
```

Within the `ggplot()` function, we specify two of the components of the grammar of graphics as arguments

1.  The `data` as the `Orders_Data` data frame via `data = Orders_Data`

2.  The `aes`thetic `mapping` by setting `mapping = aes(x = Profit, y = Sales)`. Specifically, the variable `Profit` maps to the `x` position aesthetic, while the variable `Sales` maps to the `y` position.

We then add a layer to the `ggplot()` function call using the `+` sign. The added layer in question specifies the third component of the grammar: the `geom`etric object. In this case, the geometric object is set to be points by specifying `geom_point()`.

**NOTE:** aes() is passed to either ggplot() or specific layer. Aesthetics supplied to ggplot() are used as defaults for every layer. So, we can pass the aes to the geometric object: `geom_point()`.

The `+` sign comes at the end of lines, and not at the beginning. You'll get an error in R if you put it at the beginning of a line. When adding layers to a plot, you are encouraged to start a new line after the `+` (by pressing the Return/Enter button on your keyboard) so that the code for each layer is on a new line. As we add more and more layers to plots, you'll see this will greatly improve the legibility of your code.

### Overplotting

The large mass of points near (0, 0) can cause some confusion since it is hard to tell the true number of points that are plotted. This is the result of a phenomenon called *overplotting*. As one may guess, this corresponds to points being plotted on top of each other over and over again. When overplotting occurs, it is difficult to know the number of points being plotted. There are two methods to address the issue of overplotting.

1.  Adjusting the transparency of the points or

2.  Adding a little random "jitter", or random "nudges", to each of the points.

#### **Method 1: Changing the transparency**

The first way of addressing overplotting is to change the transparency/opacity of the points by setting the `alpha` argument in `geom_point()`. We can change the `alpha` argument to be any value between `0` and `1`, where `0` sets the points to be 100% transparent and `1` sets the points to be 100% opaque. By default, `alpha` is set to `1`. In other words, if we don't explicitly set an `alpha` value, R will use `alpha = 1`.

Note how the following code is identical to the code that created the scatterplot with overplotting, but with `alpha = 0.2` added to the `geom_point()` function:

```{r scat2}

ggplot(data = Orders_Data) + 
  geom_point(mapping = aes(x = Profit, y = Sales),alpha=0.2)
```

the transparency of the points is cumulative: areas with a high-degree of overplotting are darker, whereas areas with a lower degree are less dark. Note furthermore that there is no `aes()` surrounding `alpha = 0.2`. This is because we are not mapping a variable to an aesthetic attribute, but rather merely changing the default setting of `alpha`.

#### **Method 2: Jittering the points**

The second way of addressing overplotting is by *jittering* all the points. This means giving each point a small "nudge" in a random direction. You can think of "jittering" as shaking the points around a bit on the plot.

Keep in mind, however, that jittering is strictly a visualization tool; even after creating a jittered scatterplot, the original values saved in the data frame remain unchanged.

To create a jittered scatterplot, instead of using `geom_point()`, we use `geom_jitter()`. Observe how the following code is very similar to the code that created the scatterplot with overplotting, but with `geom_point()` replaced with `geom_jitter()`.

```{r scat3}

ggplot(data = Orders_Data) + 
  geom_jitter(mapping = aes(x = Profit, y = Sales), width = 500, height = 500)
```

In order to specify how much jitter to add, we adjusted the `width` and `height` arguments to `geom_jitter()`. This corresponds to how hard you'd like to shake the plot in horizontal x-axis units and vertical y-axis units, respectively. In this case, both axes are in dollars. How much jitter should we add using the `width` and `height` arguments? On the one hand, it is important to add just enough jitter to break any overlap in points, but on the other hand, not so much that we completely alter the original pattern in points.

In this case jittering doesn't really provide much new insight. In this particular case, it can be argued that changing the transparency of the points by setting `alpha` proved more effective. When would it be better to use a jittered scatterplot? When would it be better to alter the points' transparency? There is no single right answer that applies to all situations. You need to make a subjective choice and own that choice. At the very least when confronted with overplotting, however, we suggest you make both types of plots and see which one better emphasizes the point you are trying to make.

### Summary

Scatterplots display the relationship between two numerical variables. They are among the most commonly used plots because they can provide an immediate way to see the trend in one numerical variable versus another. However, if you try to create a scatterplot where either one of the two variables is not numerical, you might get strange results. Be careful!

With medium to large datasets, you may need to play around with the different modifications to scatterplots we saw such as changing the transparency/opacity of the points or by jittering the points. This tweaking is often a fun part of data visualization, since you'll have the chance to see different relationships emerge as you tinker with your plots.

# Exercise 2

Answer the following questions starting with the following code:

```{r Ex2, eval=FALSE}

ggplot(data = Orders_Data) + 
  geom_point(mapping = aes(x = Profit, y = Sales))
```

1.  What is the relationship between `Profit` and `Sales`? (Positive, Negative, unrelated). Does this make sense?
2.  Why do you believe there is a cluster of points near (0, 0)?
3.  What are some other features of the plot that stand out to you?
4.  Why is setting the `alpha` argument value useful with scatterplots? What further information does it give you that a regular scatterplot cannot?

